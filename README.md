# Payment Gateway 
## How to build
You need docker and java 17 sdk installed on your machine.
And then run the following command (Please use gradle.bat instead of ./gradlew on windows):
```shell
./gradlew clean build
```
This will build the project and run all the tests.

## How to run
Next is to run the necessary services using docker-compose:
```shell
docker-compose up --build
```
This will start the following services:
- Payment Gateway
- MySql
- Acquiring Bank Simulator (WireMock)
- PhpMyAdmin (to be able to query the database)

## How to use

**`merchantReferenceId` needs to be generated by merchant and needs to be unique for each request.
This will prevent accidental duplicate payments, if payment gateway receives the same request twice because of infrastructure issues.**

You can send a request to the payment gateway using the following curl command (curl syntax might be slightly different on windows):

```shell
curl -X POST 'http://localhost:8080/payment' --header 'Content-Type: application/json' -u merch001:pass1 --data '{
    "merchantReferenceId": "479",
    "creditCardNumber": "1234567890123456",
    "expiryMonth": 12,
    "expiryYear": 2023,
    "amount": 100.00,
    "currency": "USD",
    "cvv": "667",
    "status": "REQUESTED"
}'
``` 

You can query the payment request using the following curl command:
```shell
curl -X GET 'http://localhost:8080/payment/479' -u merch001:pass1
```

We have two hard-coded merchant accounts in the system which are defined in the `SecurityConfiguration` class
- merch001:pass1
- merch002:pass2

## Accessing the database
if you want to check the underlying table and rows you can use phpmyadmin:
`http://localhost:5050/`

## Potential Improvements and Considerations
- Add acceptance style test against the running services inside the docker
- A better packaging (folder structure). E.g. grouping commands and queries under their own folder or grouping per business feature. 
- Asynchronous communication between payment gateway and acquiring bank. This will increase resiliency and performance of the system.
- Global error handling
- Better security, this solution definitely not production ready.
- More implementation and tests around edge cases for acquiring bank simulator.
- Add logging and monitoring

## Tech Stack
- Java 17
- Docker compose for running the necessary services locally
- MySql for database
- Spring Framework for Dependency Injection, API, Security and Database layers.
- WireMock to simulate the acquiring bank
- Moq for mock framework for unit tests
- JUnit5 for unit tests
- Flyway for database creation
